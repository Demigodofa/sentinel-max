# Agent Notes

## Orchestration pipeline
- Natural-language turns can bypass the legacy confirmation loop when `AUTO_MODE` is enabled. The `sentinel.orchestration.Orchestrator` runs tool calls automatically, publishes plan steps to the `plans` namespace, and asks for confirmation before destructive tools (`fs_delete`, `fs_write`, `pip_install`, `kill_process`).
- The plan publisher (`sentinel/orchestration/plan_publisher.py`) keeps the GUI Plan panel up to date. Update the plan steps' `status` and `note` fields to reflect queued/running/done/failed/awaiting_confirmation states.
- Post-run optimization persists alias drops and intent rules via `sentinel/orchestration/optimizer.py`; review `memory/tool_aliases.json` and `intent_rules.json` when adjusting tool schemas.
- GUI input now supports an injected command queue (`SentinelApp(..., injected_command_queue=...)`) so watchers like `sentinel/watchers/browser_command_relay.py` can feed `<START>...<STOP>` blocks from a ChatGPT tab straight into the controller without bypassing the GUI pipeline. The helper runner lives at `scripts/browser_chatgpt_relay.py`.
- The Windows launcher (`start_sentinel_max.bat`) starts the ChatGPT browser relay watcher by default when `START_BROWSER_RELAY` normalizes to `1`/`true`/`yes`/`on`. The relay is Selenium-based (Chrome window + chromedriver on PATH) and now confirms the ChatGPT page loads before polling; extracted `<START>...<STOP>` blocks are injected into the GUI queue the same way as a user pressing Enter. Relay startup status is logged to `logs/launcher_last.log` and surfaces in a dedicated window, and the launcher prints the normalized flag plus the detected `chromedriver` path (or a not-found warning) to the console and log so missed Chrome windows can be debugged immediately. When chromedriver is missing, the launcher now proceeds and relies on Selenium Manager to fetch a compatible driver (with a clear warning) instead of skipping the relay entirely. The relay process also logs a fatal error when driver creation fails so missing dependencies are explicit. To reduce false "chromedriver not found" warnings, the launcher now scans the venv `Scripts` directory and repo `scripts/` folder for a bundled `chromedriver.exe`, prepends the discovered location to `PATH`, and reports the resolved path in the log before falling back to Selenium Manager.
- The Windows launcher now preflights GUI and relay prerequisites: it checks that Tcl/Tk is installed (Tkinter import) before choosing GUI mode and runs a headless Selenium/Chrome creation test before launching the ChatGPT relay. Failed checks switch to CLI mode or skip the relay with clear console/log messaging so a missing Tk install or Chrome/driver dependency is immediately visible.
- GUI startup now raises a dedicated `GUIStartupError` when Tk/display is unavailable; `sentinel.main --mode gui` catches it and falls back to CLI mode so interactions still work on headless systems. Update this note and README if you adjust the fallback behavior or the messaging.

## Testing and docs
- New orchestration tests live in `sentinel/tests/test_orchestrator_plan_publishes.py`, `test_orchestrator_confirmation_gate.py`, and `test_optimizer_persists_rules.py`. Keep them passing when changing routing, plan publishing, confirmation gates, or optimizer behavior.
- Update this file and `README.md` whenever orchestration behavior, plan publishing semantics, or safety confirmations change.
